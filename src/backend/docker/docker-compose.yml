version: "3.8"

services:
    # -----------------------------
    # PostgreSQL (Main Database)
    # -----------------------------
    postgres:
        image: postgres:15-alpine
        container_name: hippobox-postgres
        ports:
            - "5432:5432"
        environment:
            - POSTGRES_USER=postgres
            - POSTGRES_PASSWORD=hippobox_secret
            - POSTGRES_DB=hippobox
        volumes:
            - postgres_data:/var/lib/postgresql/data
        restart: always

    # -----------------------------
    # Qdrant (Vector Database)
    # -----------------------------
    qdrant:
        image: qdrant/qdrant:latest
        container_name: hippobox-qdrant
        ports:
            - "6333:6333" # API Port
            - "6334:6334" # gRPC Port
        volumes:
            - qdrant_data:/qdrant/storage
        restart: always

    # -----------------------------
    # Redis (Cache & Rate Limiting)
    # -----------------------------
    redis:
        image: redis:alpine
        container_name: hippobox-redis
        ports:
            - "6379:6379"
        volumes:
            - redis_data:/data
        command: redis-server --appendonly yes
        restart: always

volumes:
    postgres_data:
    qdrant_data:
    redis_data:
